<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>å‡ºå¸­æƒ…å ±ç®¡ç†</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        /* ã‚¿ãƒ–æ©Ÿèƒ½ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .tab-container {
            margin-bottom: 20px;
        }
        .tab-buttons {
            display: flex;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 20px;
        }
        .tab-button {
            padding: 12px 24px;
            background-color: #f8f9fa;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: #495057;
            transition: all 0.3s ease;
            flex: 1;
            text-align: center;
        }
        .tab-button:hover {
            background-color: #e9ecef;
        }
        .tab-button.active {
            background-color: white;
            color: #007bff;
            border-bottom-color: #007bff;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        
        .filter-section {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .filter-form {
            display: flex;
            gap: 15px;
            align-items: end;
            flex-wrap: wrap;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            min-width: 120px;
        }
        .form-group label {
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        .form-group input, .form-group select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        .btn-primary:hover {
            background-color: #0056b3;
        }
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background-color: #545b62;
        }
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        .btn-success:hover {
            background-color: #218838;
        }
        
        .attendance-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
        }
        .attendance-table th,
        .attendance-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .attendance-table th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #495057;
            position: sticky;
            top: 0;
        }
        .attendance-table tr:hover {
            background-color: #f5f5f5;
        }
        
        /* æ™‚é™åˆ¥è¡¨ç¤ºç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .period-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .period-card {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .period-header {
            font-size: 18px;
            font-weight: bold;
            color: #495057;
            margin-bottom: 15px;
            text-align: center;
            background-color: #007bff;
            color: white;
            padding: 10px;
            border-radius: 5px;
        }
        .period-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
            text-align: center;
        }
        .period-stat {
            flex: 1;
        }
        .period-stat-number {
            font-size: 20px;
            font-weight: bold;
        }
        .period-stat-label {
            font-size: 12px;
            color: #6c757d;
        }
        
        /* å­¦ç”Ÿä¸€è¦§è¡¨ç¤ºç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .student-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .student-card {
            background-color: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .student-header {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #495057;
        }
        .student-status {
            margin-bottom: 8px;
        }
        
        .status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            min-width: 50px;
            display: inline-block;
        }
        .status-present {
            background-color: #d4edda;
            color: #155724;
        }
        .status-absent {
            background-color: #f8d7da;
            color: #721c24;
        }
        .status-late {
            background-color: #fff3cd;
            color: #856404;
        }
        .status-unknown {
            background-color: #e2e3e5;
            color: #6c757d;
        }
        
        .summary-section {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .summary-card {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            min-width: 120px;
            flex: 1;
        }
        .summary-number {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        .summary-label {
            color: #6c757d;
            font-size: 14px;
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        .navigation {
            margin-top: 30px;
            text-align: center;
        }
        .navigation a {
            color: #007bff;
            text-decoration: none;
            margin: 0 10px;
        }
        .navigation a:hover {
            text-decoration: underline;
        }
        
        /* æ™‚é–“åˆ¥è¡¨ç¤ºç”¨ã®è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ« */
        .time-header {
            background-color: #28a745;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š å‡ºå¸­æƒ…å ±ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
        
        <!-- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ -->
        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('individual')">ğŸ‘¤ å€‹äººåˆ¥è¡¨ç¤º</button>
                <button class="tab-button" onclick="switchTab('period')">ğŸ• æ™‚é™åˆ¥è¡¨ç¤º</button>
                <button class="tab-button" onclick="switchTab('datetime')">ğŸ“… ç‰¹å®šæ™‚é–“è¡¨ç¤º</button>
            </div>
        </div>

        <!-- å€‹äººåˆ¥è¡¨ç¤ºã‚¿ãƒ– -->
        <div id="individual" class="tab-content active">
            <div class="filter-section">
                <h3>ğŸ” å€‹äººåˆ¥æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</h3>
                <form th:action="@{/attendance/management}" method="get" class="filter-form">
                    <input type="hidden" name="view" value="individual">
                    <div class="form-group">
                        <label for="year1">å¹´</label>
                        <select name="year" id="year1" th:value="${selectedYear}">
                            <option value="">å…¨ã¦</option>
                            <option th:each="y : ${yearList}" th:value="${y}" th:text="${y}" th:selected="${y == selectedYear}"></option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="month1">æœˆ</label>
                        <select name="month" id="month1" th:value="${selectedMonth}">
                            <option value="">å…¨ã¦</option>
                            <option th:each="m : ${#numbers.sequence(1, 12)}" th:value="${m}" th:text="${m + 'æœˆ'}" th:selected="${m == selectedMonth}"></option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="period1">æ™‚é™</label>
                        <select name="period" id="period1" th:value="${selectedPeriod}">
                            <option value="">å…¨ã¦</option>
                            <option th:each="p : ${#numbers.sequence(1, 6)}" th:value="${p}" th:text="${p + 'é™'}" th:selected="${p == selectedPeriod}"></option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="userId1">å­¦ç”ŸID</label>
                        <input type="text" name="userId" id="userId1" th:value="${selectedUserId}" placeholder="å­¦ç”ŸIDã‚’å…¥åŠ›">
                    </div>
                    <div class="form-group">
                        <label for="status1">å‡ºå¸­çŠ¶æ³</label>
                        <select name="status" id="status1" th:value="${selectedStatus}">
                            <option value="">å…¨ã¦</option>
                            <option value="å‡ºå¸­" th:selected="${selectedStatus == 'å‡ºå¸­'}">å‡ºå¸­</option>
                            <option value="æ¬ å¸­" th:selected="${selectedStatus == 'æ¬ å¸­'}">æ¬ å¸­</option>
                            <option value="é…åˆ»" th:selected="${selectedStatus == 'é…åˆ»'}">é…åˆ»</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">æ¤œç´¢</button>
                        <button type="button" class="btn btn-secondary" onclick="clearFilters('individual')">ã‚¯ãƒªã‚¢</button>
                    </div>
                </form>
            </div>

            <!-- çµ±è¨ˆæƒ…å ± -->
            <div class="summary-section" th:if="${attendanceList != null and !attendanceList.empty}">
                <div class="summary-card">
                    <div class="summary-number" th:text="${totalCount}">0</div>
                    <div class="summary-label">ç·è¨˜éŒ²æ•°</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" th:text="${presentCount}">0</div>
                    <div class="summary-label">å‡ºå¸­</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" th:text="${absentCount}">0</div>
                    <div class="summary-label">æ¬ å¸­</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" th:text="${lateCount}">0</div>
                    <div class="summary-label">é…åˆ»</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" th:text="${attendanceRate}">0</div>
                    <div class="summary-label">å‡ºå¸­ç‡ï¼ˆ%ï¼‰</div>
                </div>
            </div>

            <!-- å€‹äººåˆ¥å‡ºå¸­æƒ…å ±ãƒ†ãƒ¼ãƒ–ãƒ« -->
            <div th:if="${attendanceList != null and !attendanceList.empty}">
                <h3>ğŸ“‹ å€‹äººåˆ¥å‡ºå¸­è¨˜éŒ²ä¸€è¦§</h3>
                <table class="attendance-table">
                    <thead>
                        <tr>
                            <th>å­¦ç”ŸID</th>
                            <th>æ—¥ä»˜</th>
                            <th>æ™‚é™</th>
                            <th>å‡ºå¸­çŠ¶æ³</th>
                            <th>æ¬ å¸­ç”³è«‹</th>
                            <th>å‚™è€ƒ</th>
                            <th>è¨˜éŒ²æ—¥æ™‚</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="attendance : ${attendanceList}">
                            <td th:text="${attendance.uid}">U001</td>
                            <td th:text="${attendance.dateString}">2025å¹´01æœˆ15æ—¥</td>
                            <td th:text="${attendance.period + 'é™'}">1é™</td>
                            <td>
                                <span th:class="|status ${attendance.present ? 'status-present' : (attendance.absent ? 'status-absent' : (attendance.attendanceStatus == 'é…åˆ»' ? 'status-late' : 'status-unknown'))}|"
                                      th:text="${attendance.attendanceStatus ?: 'æœªè¨˜éŒ²'}">å‡ºå¸­</span>
                            </td>
                            <td>
                                <span th:if="${attendance.absenceRequest}" class="status status-absent">ç”³è«‹æ¸ˆ</span>
                                <span th:unless="${attendance.absenceRequest}" class="status status-unknown">ãªã—</span>
                            </td>
                            <td th:text="${attendance.remarks ?: '-'}">-</td>
                            <td th:text="${#dates.format(attendance.createdAt, 'MM/dd HH:mm')}">01/15 09:00</td>
                            <td>
                                <a th:href="@{/attendance/edit/{id}(id=${attendance.id})}" class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;">ç·¨é›†</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div th:if="${attendanceList == null or attendanceList.empty}" class="no-data">
                <h3>ğŸ“­ ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</h3>
                <p>æ¤œç´¢æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹å‡ºå¸­è¨˜éŒ²ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
            </div>
        </div>

        <!-- æ™‚é™åˆ¥è¡¨ç¤ºã‚¿ãƒ– -->
        <div id="period" class="tab-content">
            <div class="filter-section">
                <h3>ğŸ• æ™‚é™åˆ¥è¡¨ç¤ºè¨­å®š</h3>
                <form th:action="@{/attendance/management}" method="get" class="filter-form">
                    <input type="hidden" name="view" value="period">
                    <div class="form-group">
                        <label for="year2">å¹´</label>
                        <select name="year" id="year2" th:value="${selectedYear}">
                            <option th:each="y : ${yearList}" th:value="${y}" th:text="${y}" th:selected="${y == selectedYear}"></option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="month2">æœˆ</label>
                        <select name="month" id="month2" th:value="${selectedMonth}">
                            <option th:each="m : ${#numbers.sequence(1, 12)}" th:value="${m}" th:text="${m + 'æœˆ'}" th:selected="${m == selectedMonth}"></option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="day2">æ—¥</label>
                        <select name="day" id="day2" th:value="${selectedDay}">
                            <option th:each="d : ${#numbers.sequence(1, 31)}" th:value="${d}" th:text="${d + 'æ—¥'}" th:selected="${d == selectedDay}"></option>
                        </select>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-success">è¡¨ç¤º</button>
                        <button type="button" class="btn btn-secondary" onclick="clearFilters('period')">ã‚¯ãƒªã‚¢</button>
                    </div>
                </form>
            </div>

            <!-- æ™‚é™åˆ¥è¡¨ç¤º -->
            <div th:if="${periodAttendanceMap != null and !periodAttendanceMap.empty}">
                <h3>ğŸ• æ™‚é™åˆ¥å‡ºå¸­çŠ¶æ³</h3>
                <div class="period-grid">
                    <div th:each="entry : ${periodAttendanceMap}" class="period-card">
                        <div class="period-header" th:text="${entry.key + 'é™'}">1é™</div>
                        <div class="period-stats">
                            <div class="period-stat">
                                <div class="period-stat-number status-present" th:text="${entry.value.presentCount}">15</div>
                                <div class="period-stat-label">å‡ºå¸­</div>
                            </div>
                            <div class="period-stat">
                                <div class="period-stat-number status-absent" th:text="${entry.value.absentCount}">3</div>
                                <div class="period-stat-label">æ¬ å¸­</div>
                            </div>
                            <div class="period-stat">
                                <div class="period-stat-number status-late" th:text="${entry.value.lateCount}">1</div>
                                <div class="period-stat-label">é…åˆ»</div>
                            </div>
                        </div>
                        <div class="student-grid">
                            <div th:each="student : ${entry.value.studentList}" class="student-card">
                                <div class="student-header" th:text="${student.uid}">S001</div>
                                <div class="student-status">
                                    <span th:class="|status ${student.present ? 'status-present' : (student.absent ? 'status-absent' : (student.attendanceStatus == 'é…åˆ»' ? 'status-late' : 'status-unknown'))}|"
                                          th:text="${student.attendanceStatus ?: 'æœªè¨˜éŒ²'}">å‡ºå¸­</span>
                                </div>
                                <div th:if="${student.remarks}" class="student-remarks" th:text="${student.remarks}">å‚™è€ƒ</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div th:if="${periodAttendanceMap == null or periodAttendanceMap.empty}" class="no-data">
                <h3>ğŸ“­ ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</h3>
                <p>æŒ‡å®šã•ã‚ŒãŸæ—¥ä»˜ã®å‡ºå¸­è¨˜éŒ²ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
            </div>
        </div>

        <!-- ç‰¹å®šæ™‚é–“è¡¨ç¤ºã‚¿ãƒ– -->
        <div id="datetime" class="tab-content">
            <div class="filter-section">
                <h3>ğŸ“… ç‰¹å®šæ™‚é–“ã®å‡ºå¸­çŠ¶æ³</h3>
                <form th:action="@{/attendance/management}" method="get" class="filter-form">
                    <input type="hidden" name="view" value="datetime">
                    <div class="form-group">
                        <label for="year3">å¹´</label>
                        <select name="year" id="year3" th:value="${selectedYear}" required>
                            <option th:each="y : ${yearList}" th:value="${y}" th:text="${y}" th:selected="${y == selectedYear}"></option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="month3">æœˆ</label>
                        <select name="month" id="month3" th:value="${selectedMonth}" required>
                            <option th:each="m : ${#numbers.sequence(1, 12)}" th:value="${m}" th:text="${m + 'æœˆ'}" th:selected="${m == selectedMonth}"></option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="day3">æ—¥</label>
                        <select name="day" id="day3" th:value="${selectedDay}" required>
                            <option th:each="d : ${#numbers.sequence(1, 31)}" th:value="${d}" th:text="${d + 'æ—¥'}" th:selected="${d == selectedDay}"></option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="period3">æ™‚é™</label>
                        <select name="period" id="period3" th:value="${selectedPeriod}" required>
                            <option th:each="p : ${#numbers.sequence(1, 6)}" th:value="${p}" th:text="${p + 'é™'}" th:selected="${p == selectedPeriod}"></option>
                        </select>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-success">è¡¨ç¤º</button>
                        <button type="button" class="btn btn-secondary" onclick="clearFilters('datetime')">ã‚¯ãƒªã‚¢</button>
                    </div>
                </form>
            </div>

            <!-- ç‰¹å®šæ™‚é–“ã®è¡¨ç¤º -->
            <div th:if="${datetimeAttendanceList != null and !datetimeAttendanceList.empty}">
                <div class="time-header">
                    ğŸ“… <span th:text="${selectedYear}">2025</span>å¹´<span th:text="${selectedMonth}">1</span>æœˆ<span th:text="${selectedDay}">15</span>æ—¥ <span th:text="${selectedPeriod}">1</span>é™ã®å‡ºå¸­çŠ¶æ³
                </div>
                
                <!-- çµ±è¨ˆæƒ…å ± -->
                <div class="summary-section">
                    <div class="summary-card">
                        <div class="summary-number" th:text="${datetimeTotalCount}">0</div>
                        <div class="summary-label">ç·å­¦ç”Ÿæ•°</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number" th:text="${datetimePresentCount}">0</div>
                        <div class="summary-label">å‡ºå¸­</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number" th:text="${datetimeAbsentCount}">0</div>
                        <div class="summary-label">æ¬ å¸­</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number" th:text="${datetimeLateCount}">0</div>
                        <div class="summary-label">é…åˆ»</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number" th:text="${datetimeAttendanceRate}">0</div>
                        <div class="summary-label">å‡ºå¸­ç‡ï¼ˆ%ï¼‰</div>
                    </div>
                </div>

                <!-- å­¦ç”Ÿä¸€è¦§ -->
                <h3>ğŸ‘¥ å­¦ç”Ÿä¸€è¦§</h3>
                <div class="student-grid">
                    <div th:each="student : ${datetimeAttendanceList}" class="student-card">
                        <div class="student-header" th:text="${student.uid}">S001</div>
                        <div class="student-status">
                            <span th:class="|status ${student.present ? 'status-present' : (student.absent ? 'status-absent' : (student.attendanceStatus == 'é…åˆ»' ? 'status-late' : 'status-unknown'))}|"
                                  th:text="${student.attendanceStatus ?: 'æœªè¨˜éŒ²'}">å‡ºå¸­</span>
                        </div>
                        <div th:if="${student.absenceRequest}" class="student-status">
                            <span class="status status-absent">æ¬ å¸­ç”³è«‹æ¸ˆ</span>
                        </div>
                        <div th:if="${student.remarks}" class="student-remarks" th:text="${student.remarks}">å‚™è€ƒ</div>
                        <div style="margin-top: 10px;">
                            <a th:href="@{/attendance/edit/{id}(id=${student.id})}" class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;">ç·¨é›†</a>
                        </div>
                    </div>
                </div>
            </div>

            <div th:if="${datetimeAttendanceList == null or datetimeAttendanceList.empty}" class="no-data">
                <h3>ğŸ“­ ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</h3>
                <p>æŒ‡å®šã•ã‚ŒãŸæ—¥æ™‚ã®å‡ºå¸­è¨˜éŒ²ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
            </div>
        </div>

        <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <div class="navigation">
            <a th:href="@{/attendance/export}" class="btn btn-secondary">ğŸ“Š CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</a>
            <a th:href="@{/attendance/register}" class="btn btn-primary">â• æ–°è¦ç™»éŒ²</a>
            <a th:href="@{/}">ğŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>
        </div>
    </div>

    <script>
        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
        function switchTab(tabName) {
            // ã™ã¹ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¯ãƒªã‚¢æ©Ÿèƒ½
        function clearFilters(tabType) {
            if (tabType === 'individual') {
                document.getElementById('year1').value = '';
                document.getElementById('month1').value = '';
                document.getElementById('period1').value = '';
                document.getElementById('userId1').value = '';
                document.getElementById('status1').value = '';
            } else if (tabType === 'period') {
                document.getElementById('year2').value = '';
                document.getElementById('month2').value = '';
                document.getElementById('day2').value = '';
            } else if (tabType === 'datetime') {
                document.getElementById('year3').value = '';
                document.getElementById('month3').value = '';
                document.getElementById('day3').value = '';
                document.getElementById('period3').value = '';
            }
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const currentYear = now.getFullYear();
            const currentMonth = now.getMonth() + 1;
            const currentDay = now.getDate();
            
            // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ç¾åœ¨ã®ãƒ“ãƒ¥ãƒ¼ã‚’å–å¾—
            const urlParams = new URLSearchParams(window.location.search);
            const currentView = urlParams.get('view') || 'individual';
            
            // é©åˆ‡ãªã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
            switchTab(currentView);
            
            // å„ã‚¿ãƒ–ã®å¹´æœˆæ—¥ã‚’ç¾åœ¨ã®æ—¥ä»˜ã§åˆæœŸåŒ–ï¼ˆå€¤ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆï¼‰
            ['1', '2', '3'].forEach(suffix => {
                const yearSelect = document.getElementById(`year${suffix}`);
                const monthSelect = document.getElementById(`month${suffix}`);
                const daySelect = document.getElementById(`day${suffix}`);
                
                if (yearSelect && !yearSelect.value) {
                    yearSelect.value = currentYear;
                }
                if (monthSelect && !monthSelect.value) {
                    monthSelect.value = currentMonth;
                }
                if (daySelect && !daySelect.value) {
                    daySelect.value = currentDay;
                }
            });
        });

        // ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ï¼ˆç°¡æ˜“ç‰ˆï¼‰
        function sortTable(columnIndex) {
            const table = document.querySelector('.attendance-table');
            if (!table) return;
            
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            rows.sort((a, b) => {
                const aValue = a.cells[columnIndex].textContent.trim();
                const bValue = b.cells[columnIndex].textContent.trim();
                return aValue.localeCompare(bValue);
            });
            
            rows.forEach(row => tbody.appendChild(row));
        }
    </script>
</body>
</html>